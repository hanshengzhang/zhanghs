---
layout: post
category: tech
title: 构建Data Pipeline的几点经验
---

**1. 尽早失败**

- Pipeline可能会因为多种原因失败（挂掉、超时或没有产生预期的结果等）。
- 在开发的过程中，语言的选择和更谨慎的类型转化可以让程序在编译时就挂掉，单元测试和集成测试也有助于让某些错误更早的产生失败。
- 在上游失败永远是一个更好的选项。有人会说为了更早的产生数据价值和让Pipeline更稳定，部分错误可以被容忍。这种情况需要对所谓“部分错误”进行描述和建模，承诺错误率或者设计对应的再提交阶段。这“部分错误”实际是预期内的合法状态。
- 通过一系列的监控去表述合法的输入和输出，不要尝试去处理超过已有认知的输入。
- 千万不要吃掉“失败”，让失败悄无声息被遗漏。
- 这里有个原则叫[*Fail Fast*](https://www.martinfowler.com/ieeeSoftware/failFast.pdf)，部分有类似之处。

**2. 拒绝魔术**

- 一个人的已有认知给什么事情是合理的划定了一个边界，超过这个边界的叫魔术。
- 扩大这个边界。遇到和自己的认知不相符的神奇的事情要尽量知道背后机制，例如同样跑在JVM上为什么Scala可以写，翻译成Java是什么样子的，或者为什么有些情况下查询不能优化成我想要的样子。
- 尊重这个边界。还不清楚背后机制的“魔术”谨慎使用。
- 有时候任务挂掉，点下重跑就正常了，也要去看下为什么，不然总有一天不管你怎么点“重跑”，Pipeline都不能恢复正常。

**3.描述状态**

# 3. 描述状态 (2018)

Essential. idempotence.

# 4. 检验假设 (2018)



# Lesson 5: Make the component act correctly (2019)

# Lesson 6: Implement two-stage compatibility (2019)

